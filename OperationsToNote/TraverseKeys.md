# 遍历键

Redis提供了两个命令遍历所有键，keys和scan。

#### 全量遍历键

```
keys pattern
```
pattern通配符：

* \* 代表匹配任意字符
* ? 代表匹配一个字符
* [] 代表部分字符，例如[1,3]代表匹配1，3，[1-10]代表匹配1-10任意数字
* \x 用来做转义

**但是Redis是单线程架构，如果存在大量键，执行keys命令可能会造成Redis阻塞，所以在生产环境下不建议使用keys命令。**


### 渐进式遍历键

Redis从2.8版本后，提供了scan命令，和keys遍历所有键不同，scan采用渐进式遍历的方式来解决keys可能带来的阻塞问题。每次scan命令的时间复杂度是O(1)，要真正的实现keys功能需要执行多次scan。

```
  scan cursor [match pattern] [count number]
```

* cursor是必须参数，代表一个游标，第一次遍历从0开始，每次scan执行完返回当前的游标值，游标值为0表示遍历结束。
* match pattern是可选参数，作用是模式匹配，同keys的模式匹配。
* count number是可选参数，作用是每次遍历的键的个数，默认10。

除了scan外，Redis提供了面向哈希类型，集合类型，有序集合类型的渐进式遍历命令：hscan，sscan，zscan，用来解决hgetall，smembers，zrange可能带来的阻塞问题。

**渐进式遍历可以有效的解决keys命令可能产生的阻塞问题，但是如果scan等过程中有键的变化（增加，修改，删除），那么可能会有如下问题：新增的键没有遍历到，遍历出重复的键等。所以scan等并不能保证完整的遍历出所有的键，这些是在开发时需要考虑的。**
